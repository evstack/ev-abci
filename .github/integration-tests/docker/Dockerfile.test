# Use shared binaries base image
FROM integration-tests-binaries:latest as binaries

# Create test user (Debian-based image)
RUN useradd -m -s /bin/bash tester

# Copy test scripts
COPY --chown=tester:tester integration-tests/scripts/run-integration-test.sh /home/tester/run-integration-test.sh
COPY --chown=tester:tester integration-tests/scripts/setup-ibc.sh /home/tester/setup-ibc.sh
COPY --chown=tester:tester integration-tests/scripts/test-transfers.sh /home/tester/test-transfers.sh
COPY --chown=tester:tester integration-tests/scripts/wait-for-chain.sh /home/tester/wait-for-chain.sh
COPY --chown=tester:tester integration-tests/scripts/wait-for-attester.sh /home/tester/wait-for-attester.sh

# Copy hermes config template
COPY --chown=tester:tester integration-tests/config/hermes.toml /home/tester/hermes.toml

# Make scripts executable
RUN chmod +x /home/tester/*.sh

# Switch to test user
USER tester
WORKDIR /home/tester

# Environment variables
ENV GM_RPC=http://gm-chain:26757
ENV GM_GRPC=http://gm-chain:9190
ENV GM_API=http://gm-chain:1417
ENV GAIA_RPC=http://gaia-chain:26657
ENV GAIA_GRPC=http://gaia-chain:9090
ENV GAIA_API=http://gaia-chain:1317
ENV HERMES_HOME=/home/tester/.hermes
