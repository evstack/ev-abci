# Build local-da from ev-node source
FROM golang:1.24-alpine AS builder

# Install build dependencies
RUN apk add --no-cache gcc musl-dev git

# Set working directory
WORKDIR /workspace

# Copy ev-node source
COPY ev-node .

# Build local-da binary from the correct path
RUN cd da/cmd/local-da && go build -o /workspace/local-da .

# Runtime stage
FROM alpine:3.18

# Install runtime dependencies
RUN apk add --no-cache ca-certificates curl netcat-openbsd

# Copy binary from builder
COPY --from=builder /workspace/local-da /usr/local/bin/local-da

# Make binary executable
RUN chmod +x /usr/local/bin/local-da

# Expose port
EXPOSE 7980

# Default command
CMD ["local-da", "-listen-all"]