# Build local-da from ev-node source
FROM golang:1.24-alpine AS builder

# Install build dependencies
RUN apk add --no-cache gcc musl-dev git

# Set working directory
WORKDIR /workspace

# Build local-da from ev-node module at the requested version (tag/branch/pseudo-version)
ARG EV_NODE_REF=main
RUN GOBIN=/workspace go install github.com/evstack/ev-node/da/cmd/local-da@${EV_NODE_REF}

# Runtime stage
FROM alpine:3.18

# Install runtime dependencies
RUN apk add --no-cache ca-certificates curl netcat-openbsd

# Copy binary from builder
COPY --from=builder /workspace/local-da /usr/local/bin/local-da

# Make binary executable
RUN chmod +x /usr/local/bin/local-da

# Expose port
EXPOSE 7980

# Default command
CMD ["local-da", "-listen-all"]
